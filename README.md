# Тестовое задание HARDCODE

## Системные требования

- .NET 8
- СУБД PostgreSQL v16
- RabbitMQ v4

## Структура приложения

### Микросервис управления заказами (Order Service)
Реализован в виде решения HRDCD.Order, и включает в себя следующие запускаемые проекты:

#### HRDCD.Order.Api
Проект с REST-сервисами для работы с заказами. Запускается с помощью команды:

`hrdcd\back\HRDCD.Order\HRDCD.Order.Api>dotnet run`

из директории проекта.

Настройки приложения состоят из строки подключения к БД в файле appsettings.json в папке проекта.

#### HRDCD.Faker
Консольное приложение для генерации тестовых данных. Для генерации данных, необходимо запустить приложение командой:

`hrdcd\back\HRDCD.Order\HRDCD.Order.Faker>dotnet run`

В результате в БД будет записана 1 тысяча тестовых заказов. Настройки приложения состоят из строки подключения к БД в файле _appsettings.json_ в папке проекта.

#### HRDCD.Order.Sender
Консольное приложение для отправки сохраненных в БД заказов в очередь RabbitMQ. Для запуска необходимо выполнить команду:

`hrdcd\back\HRDCD.Order\HRDCD.Order.Sender>dotnet run`

В конфигурационном файле _appsettings.json_ необходимо отредактировать как секцию подключения к БД,
так и секцию _"QueueSettings"_. В ней нужно внести настройки для подключения к RabbitMQ, и наименование очереди, в которую будут
отправляться сообщения о заказах. В дальнейшем из этой очереди будет читать сообщения микросервис управления доставкой, поэтому в нем нужно будет указать это же значение параметра _QueueName_.

### Микросервис управления доставкой (Delivery Service)
Реализован в виде решения HRDCD.Delivery, и включает в себя следующие запускаемые проекты:

### HRDCD.Delivery.Api
Проект с REST-сервисами для работы с полученными из очереди заказами и заявками на их доставку.
Запускается с помощью команды:

`hrdcd\back\HRDCD.Delivery\HRDCD.Delivery.Api>dotnet run`

из директории проекта.

Настройки приложения состоят из строки подключения к БД в файле _appsettings.json_ в папке проекта.

### HRDCD.Delivery.Consumer
Консольное приложение для приёмки заказов из очереди RabbitMQ. Для запуска необходимо выполнить команду:

`hrdcd\back\HRDCD.Delivery\HRDCD.Delivery.Consumer>dotnet run`

В конфигурационном файле _appsettings.json_ необходимо отредактировать как секцию подключения к БД,
так и секцию "QueueSettings". В ней нужно внести настройки для подключения к RabbitMQ, и наименование очереди, в которую будут
отправляться сообщения о заказах _(см. раздел настроек приложения __HRDCD.Order.Sender__)_.

## Маршрутизация запросов

Для маршрутизации запросов в проекте используется Ocelot, а реализация сделана в решении HRDCD.Gateway.
В этом решении один проект - HRDCD.Gateway.Ocelot, и для маршрутизации запросов нужно его запустить командой:

``hrdcd\back\HRDCD.Gateway\HRDCD.Gateway.Ocelot>dotnet run`

После этого, можно будет обращаться к REST-сервису заказов (http://localhost:5001) и доставки (http://localhost:5002) не
напрямую, а через маршрутизатор, доступный на адресе http://localhost:5005.

Настройки маршрутизации описаны в файле _ocelot.json_ в корневой папке приложения HRDCD.Gateway.Ocelot.

Запросы к http://localhost:5005/gateway/order* будут транслироваться на адрес __сервиса заказов__ - http://localhost:5001/api/order,
а запросы на адрес(а) http://localhost:5005/gateway/delivery*, в свою очередь, на адрес __сервиса доставки__ - http://localhost:5002/api/*.


## Создание БД для микросервисов

### БД Order Service

Для генерации структуры БД данного микросервиса, нужно выполнить команду в корневой директории решения HRDCD.Order:

`hrdcd\back\HRDCD.Order>dotnet ef database update --project .\HRDCD.Order.Database\`

При этом, нужно учесть, что данные для подключения к БД будут браться из файла _appsettings.json_ проекта HRDCD.__Order__.Api.

### БД Delivery Service

Для генерации структуры БД данного микросервиса, нужно выполнить команду в корневой директории решения HRDCD.Delivery:

`hrdcd\back\HRDCD.Delivery>dotnet ef database update --project .\HRDCD.Delivery.Database\`

При этом, нужно учесть, что данные для подключения к БД будут браться из файла _appsettings.json_ проекта HRDCD.__Delivery__.Api.

